# Wameter Server Configuration
server:
  # Listen address
  address: ":8080"
  # Request timeouts
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 60s
  # Metrics endpoint path
  metrics_path: "/metrics"

  # TLS configuration
  tls:
    enabled: false
    cert_file: "/etc/wameter/server.crt"
    key_file: "/etc/wameter/server.key"
    client_ca: "/etc/wameter/ca.crt"
    min_version: "TLS1.2"
    require_client_cert: false

# Storage configuration
storage:
  # Storage type: sqlite, mysql, postgres
  driver: "sqlite"
  # Database path/connection string
  dsn: "/var/lib/wameter/data.db"

  # Connection pool settings
  max_connections: 25
  max_idle_conns: 5
  conn_max_lifetime: 1h
  query_timeout: 30s

  # Migration settings
  auto_migrate: true
  migrations_path: "/etc/wameter/migrations"

  # Data retention settings
  enable_pruning: true
  metrics_retention: 720h  # 30 days
  prune_interval: 24h     # Cleanup interval

  # Batch settings
  max_batch_size: 1000
  max_query_rows: 100
  slow_query_time: 1s

# API configuration
api:
  enabled: true

  # Authentication
  auth:
    enabled: true
    type: "jwt"        # jwt, apikey, basic
    jwt_secret: ""     # Set this in production
    jwt_duration: 24h  # Token validity duration
    allowed_users: # For apikey/basic auth
      - "admin:secretpassword"

  # CORS settings
  cors:
    enabled: true
    allowed_origins:
      - "*"
    allowed_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "OPTIONS"
    allowed_headers:
      - "Content-Type"
      - "Authorization"
      - "X-Request-ID"
    max_age: 86400
    allow_credentials: true

  # Rate limiting
  rate_limit:
    enabled: true
    requests: 60     # Requests per window
    window: 60s      # Time window
    strategy: "token" # token, leaky, sliding

  # API documentation
  docs:
    enabled: true
    path: "/docs"
    title: "Wameter API"
    version: "v1"

  # Metrics collection
  metrics:
    enabled: true
    path: "/metrics"
    prometheus: true
    statsd_addr: "localhost:8125"
    service_name: "wameter"

# Notification configuration
notify:
  # Email notifications
  email:
    enabled: false
    smtp_server: "smtp.example.com"
    smtp_port: 587
    username: "notifications@example.com"
    password: ""  # Set this in production
    from: "wameter@example.com"
    to:
      - "admin@example.com"
    use_tls: true
    templates:
      agent_offline: "/etc/wameter/templates/agent_offline.html"
      high_usage: "/etc/wameter/templates/high_usage.html"

  # Telegram notifications
  telegram:
    enabled: false
    bot_token: ""  # Set this in production
    chat_ids:
      - "-100123456789"
    format: "markdown"  # text, html, markdown

  # Webhook notifications
  webhook:
    enabled: false
    url: "https://hooks.example.com/wameter"
    method: "POST"
    secret: ""  # Set this in production
    timeout: 10s
    max_retries: 3
    headers:
      X-Custom-Header: "value"
    common_data:
      environment: "production"

  # Slack notifications
  slack:
    enabled: false
    webhook_url: ""  # Set this in production
    channel: "#monitoring"
    username: "Wameter Bot"
    icon_emoji: ":chart_with_upwards_trend:"

# Logging configuration
log:
  level: "info"
  format: "json"  # json, console
  file: "/var/log/wameter/server.log"
  max_size: 100
  max_backups: 7
  max_age: 30
  compress: true
  color: true
